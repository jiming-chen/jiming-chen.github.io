<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Lecture 7: Peripherals and GPIO | Jiming Chen</title><meta name=keywords content><meta name=description content="So far, we have used the OpenSDA USB which connects to an ARM debugging chip which is serially connected to the KL46Z256. This can interface with the red LED. We can also interface with a segment LCD, magnetometer, and accelerometer.
The chip has a lot of pins surrounding it, and it is isometric, so we can match the dot on the diagram with a dimple on the chip. Note that some pins are labeled similarly, e.g. PT means port."><meta name=author content="Jiming Chen"><link rel=canonical href=https://jiming-chen.github.io/courses/cs3420/lecture07/><link crossorigin=anonymous href=/assets/css/stylesheet.d20d31710e1e17ede7c7f9ededb138159f9228abc86b338e8d1053ed139865b7.css integrity="sha256-0g0xcQ4eF+3nx/nt7bE4FZ+SKKvIazOOjRBT7ROYZbc=" rel="preload stylesheet" as=style><link rel=icon href=https://jiming-chen.github.io/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jiming-chen.github.io/icons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jiming-chen.github.io/icons/favicon-32x32.png><link rel=apple-touch-icon href=https://jiming-chen.github.io/icons/apple-touch-icon.png><link rel=mask-icon href=https://jiming-chen.github.io/%3C/icons/apple-touch-icon.png%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://jiming-chen.github.io/courses/cs3420/lecture07/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KTD621L9T6"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KTD621L9T6")</script><meta property="og:url" content="https://jiming-chen.github.io/courses/cs3420/lecture07/"><meta property="og:site_name" content="Jiming Chen"><meta property="og:title" content="Lecture 7: Peripherals and GPIO"><meta property="og:description" content="So far, we have used the OpenSDA USB which connects to an ARM debugging chip which is serially connected to the KL46Z256. This can interface with the red LED. We can also interface with a segment LCD, magnetometer, and accelerometer.
The chip has a lot of pins surrounding it, and it is isometric, so we can match the dot on the diagram with a dimple on the chip. Note that some pins are labeled similarly, e.g. PT means port."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="courses"><meta property="article:published_time" content="2025-02-11T13:29:15-05:00"><meta property="article:modified_time" content="2025-02-11T13:29:15-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lecture 7: Peripherals and GPIO"><meta name=twitter:description content="So far, we have used the OpenSDA USB which connects to an ARM debugging chip which is serially connected to the KL46Z256. This can interface with the red LED. We can also interface with a segment LCD, magnetometer, and accelerometer.
The chip has a lot of pins surrounding it, and it is isometric, so we can match the dot on the diagram with a dimple on the chip. Note that some pins are labeled similarly, e.g. PT means port."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Course Notes","item":"https://jiming-chen.github.io/courses/"},{"@type":"ListItem","position":2,"name":"CS 3420: Embedded Systems","item":"https://jiming-chen.github.io/courses/cs3420/"},{"@type":"ListItem","position":3,"name":"Lecture 7: Peripherals and GPIO","item":"https://jiming-chen.github.io/courses/cs3420/lecture07/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Lecture 7: Peripherals and GPIO","name":"Lecture 7: Peripherals and GPIO","description":"So far, we have used the OpenSDA USB which connects to an ARM debugging chip which is serially connected to the KL46Z256. This can interface with the red LED. We can also interface with a segment LCD, magnetometer, and accelerometer.\nThe chip has a lot of pins surrounding it, and it is isometric, so we can match the dot on the diagram with a dimple on the chip. Note that some pins are labeled similarly, e.g. PT means port.\n","keywords":[],"articleBody":"So far, we have used the OpenSDA USB which connects to an ARM debugging chip which is serially connected to the KL46Z256. This can interface with the red LED. We can also interface with a segment LCD, magnetometer, and accelerometer.\nThe chip has a lot of pins surrounding it, and it is isometric, so we can match the dot on the diagram with a dimple on the chip. Note that some pins are labeled similarly, e.g. PT means port.\nFig. 1. Diagram of pins for KL46Z256. If you wanted to hook up other electronics to the chip, you would hook it up to one of the port pins. It is important to use current-limiting resistors as to not burn out the port.\nA general-purpose input and output (GPIO) can be thought of as a switch. It can read whether an input signal is 1 or 0, and it can output 1 or 0. The signal’s value is determined by voltage through the pin as a functoni of supply voltage ($V_{DD}$). For us, the supply voltage is 3.3 volts.\nSince we have a maximum current, we need a resistor with a minimum resistance.\nHow do we read and write data to and from the GPIO? We could directly connect a register with a pin, or we could add additionally circuitry and muxes.\nIn the Z80 ISA, there were specific instructions:\nout (243), A would output the value in register A to port 243. in A,254 would read the value in port 254 and store it in register A. The SNAP ISA mapped register 15 to input/output.\nFor us, we use memory-mapped I/O, so we treat interactions with I/O as if they were memory operations (implemented using muxes). GPIO devices on the chip would go in the peripheral memory space while off-chip (but could be on the same PCB) devices would go in the external device memory space.\nEach peripheral slot has a lot of bytes to interact with, so you don’t need to use all of them.\nOn our chip, we have way more functionality than pins, which explains why we have a mux. If we can multiplex and select whether to connect to pins or one of the many functions, then there is more flexibility.\nIf you want to use GPIO, you set MUX = 001 by writing 1\u003c\u003c8 = 0x100 to PORTX_PCRn.\nThere are also data direction registers in the memory. It can be dangerous to drive a line that is connected to something else, so we default to input.\nThe LED code for lab 1 can be broken into three pieces:\nTurn on the clock. Mux to the LED. Set direction to output. There are memory locations called Port Set Output Registers that can set all the bits that are 1 in the register to 1 in a port. It can also clear certain bits and invert certain bits.\nIn our LEDON and LEDOFF code, LEDON uses PCOR while LEDOFF which is PSOR, which is counterintuitive because we have high voltage turning off the LED and low voltage turning it on. This is because electronics used to be that turning off a current was easier than turning on a current.\n","wordCount":"532","inLanguage":"en","datePublished":"2025-02-11T13:29:15-05:00","dateModified":"2025-02-11T13:29:15-05:00","author":{"@type":"Person","name":"Jiming Chen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jiming-chen.github.io/courses/cs3420/lecture07/"},"publisher":{"@type":"Organization","name":"Jiming Chen","logo":{"@type":"ImageObject","url":"https://jiming-chen.github.io/icons/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jiming-chen.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://jiming-chen.github.io/icons/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jiming-chen.github.io/about title="About Me"><span>About Me</span></a></li><li><a href=https://jiming-chen.github.io/projects/ title=Portfolio><span>Portfolio</span></a></li><li><a href=https://jiming-chen.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://jiming-chen.github.io/courses/ title="Course Notes"><span>Course Notes</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Lecture 7: Peripherals and GPIO</h1><div class=post-meta><span title='2025-02-11 13:29:15 -0500 -0500'>February 11, 2025</span>&nbsp;·&nbsp;Jiming Chen</div></header><div class=post-content><p>So far, we have used the OpenSDA USB which connects to an ARM debugging chip which is serially connected to the KL46Z256. This can interface with the red LED. We can also interface with a segment LCD, magnetometer, and accelerometer.</p><p>The chip has a lot of pins surrounding it, and it is isometric, so we can match the dot on the diagram with a dimple on the chip. Note that some pins are labeled similarly, e.g. PT means port.</p><img src=/courses/cs3420/lecture07/pins.png alt="KL46Z256 pin diagram" width=80% class=center><figcaption>Fig. 1. Diagram of pins for KL46Z256.</figcaption><p>If you wanted to hook up other electronics to the chip, you would hook it up to one of the port pins. It is important to use current-limiting resistors as to not burn out the port.</p><p>A <em>general-purpose input and output</em> (GPIO) can be thought of as a switch. It can read whether an input signal is 1 or 0, and it can output 1 or 0. The signal&rsquo;s value is determined by voltage through the pin as a functoni of supply voltage ($V_{DD}$). For us, the supply voltage is 3.3 volts.</p><p>Since we have a maximum current, we need a resistor with a minimum resistance.</p><p>How do we read and write data to and from the GPIO? We could directly connect a register with a pin, or we could add additionally circuitry and muxes.</p><p>In the Z80 ISA, there were specific instructions:</p><ul><li><code>out (243), A</code> would output the value in register A to port 243.</li><li><code>in A,254</code> would read the value in port 254 and store it in register A.</li></ul><p>The SNAP ISA mapped register 15 to input/output.</p><p>For us, we use memory-mapped I/O, so we treat interactions with I/O as if they were memory operations (implemented using muxes). GPIO devices on the chip would go in the peripheral memory space while off-chip (but could be on the same PCB) devices would go in the external device memory space.</p><p>Each peripheral slot has a lot of bytes to interact with, so you don&rsquo;t need to use all of them.</p><p>On our chip, we have way more functionality than pins, which explains why we have a mux. If we can multiplex and select whether to connect to pins or one of the many functions, then there is more flexibility.</p><p>If you want to use GPIO, you set MUX = 001 by writing <code>1&lt;&lt;8 = 0x100</code> to <code>PORTX_PCRn</code>.</p><p>There are also data direction registers in the memory. It can be dangerous to drive a line that is connected to something else, so we default to input.</p><p>The LED code for lab 1 can be broken into three pieces:</p><ol><li>Turn on the clock.</li><li>Mux to the LED.</li><li>Set direction to output.</li></ol><p>There are memory locations called Port Set Output Registers that can set all the bits that are 1 in the register to 1 in a port. It can also clear certain bits and invert certain bits.</p><p>In our LEDON and LEDOFF code, LEDON uses PCOR while LEDOFF which is PSOR, which is counterintuitive because we have high voltage turning off the LED and low voltage turning it on. This is because electronics used to be that turning off a current was easier than turning on a current.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://jiming-chen.github.io/>Jiming Chen</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>